package dev.tenacity.module.impl.exploit;

import dev.tenacity.event.impl.player.movement.MotionEvent;
import dev.tenacity.module.Category;
import dev.tenacity.module.Module;
import dev.tenacity.module.settings.impl.BooleanSetting;
import dev.tenacity.module.settings.impl.MultipleBoolSetting;
import dev.tenacity.module.settings.impl.NumberSetting;
import dev.tenacity.utils.player.ChatUtil;
import net.minecraft.block.Block;
import net.minecraft.init.Blocks;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.util.BlockPosition;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.MathHelper;
import net.minecraft.entity.EntityLivingBase;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

@SuppressWarnings("unused")
public final class Breaker extends Module {

    public Breaker() {
        super("Breaker", Category.EXPLOIT, "Breaks Beds Throw Walls");
        this.addSettings(Swing,Range,Debug,modes);
    }

    private final MultipleBoolSetting modes = new MultipleBoolSetting(
            "TargetBlock",
            new BooleanSetting("Bed", false),
            new BooleanSetting("Cake", false),
            new BooleanSetting("Egg", false)

    );
    private final BooleanSetting Swing = new BooleanSetting("Swing", true);
    private final BooleanSetting Debug = new BooleanSetting("Debug", false);
    private final NumberSetting Range = new NumberSetting("Range", 3, 8, 3, 1);




    public float[] rotateToBlock(EntityLivingBase player, BlockPosition targetBlock) {
        double x = targetBlock.getX() + 0.5 - player.posX;
        double y = targetBlock.getY() + 0.5 - (player.posY + player.getEyeHeight());
        double z = targetBlock.getZ() + 0.5 - player.posZ;

        double distance = MathHelper.sqrt_double(x * x + z * z);
        float yaw = (float) (Math.atan2(z, x) * 180.0 / Math.PI) - 90.0F;
        float pitch = (float) (-(Math.atan2(y, distance) * 180.0 / Math.PI));

        return new float[]{yaw, pitch};
    }

    @Override
    public void onMotionEvent(MotionEvent event) {
        this.setSuffix("Normal");
        int detectionRange = Range.getValue().intValue();

        for (int x = (int) mc.thePlayer.posX - detectionRange; x <= mc.thePlayer.posX + detectionRange; x++) {
            for (int y = (int) mc.thePlayer.posY - detectionRange; y <= mc.thePlayer.posY + detectionRange; y++) {
                for (int z = (int) mc.thePlayer.posZ - detectionRange; z <= mc.thePlayer.posZ + detectionRange; z++) {
                    BlockPosition position = new BlockPosition(x, y, z);
                    Block block = mc.theWorld.getBlockState(position).getBlock();

                    List<Block> blocks = new ArrayList<>(Arrays.asList(Blocks.bed, Blocks.cake, Blocks.dragon_egg));

                    if (mc.thePlayer.ticksExisted % 9 == 0 && blocks.contains(block)) {
                        mc.thePlayer.sendQueue.addToSendQueue(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.START_DESTROY_BLOCK, new BlockPosition(x, y, z), EnumFacing.UP));

                        if (Swing.isEnabled()) {
                            mc.thePlayer.swingItem();
                        }

                        mc.thePlayer.sendQueue.addToSendQueue(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.STOP_DESTROY_BLOCK, new BlockPosition(x, y, z), EnumFacing.UP));

                        ChatUtil.print("Successfully broken the " + block.getUnlocalizedName());
                    }
                }
            }
        }
    }

    // WASD
}


