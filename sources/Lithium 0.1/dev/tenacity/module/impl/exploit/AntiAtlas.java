package dev.tenacity.module.impl.exploit;

import dev.tenacity.event.impl.game.world.WorldEvent;
import dev.tenacity.event.impl.network.PacketReceiveEvent;
import dev.tenacity.event.impl.player.UpdateEvent;
import dev.tenacity.module.Category;
import dev.tenacity.module.Module;
import dev.tenacity.utils.server.PacketUtils;
import dev.tenacity.utils.time.TimerUtil;
import net.minecraft.client.network.NetworkPlayerInfo;
import net.minecraft.network.play.client.C01PacketChatMessage;
import net.minecraft.network.play.server.S02PacketChat;

import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

public class AntiAtlas extends Module {

    public TimerUtil timer = new TimerUtil();
    public List<UUID> reported = new ArrayList<>();

    public AntiAtlas() {
        super("AntiAtlas", Category.EXPLOIT, "Prevents people from seeing you on Atlas.");
    }

    @Override
    public void onUpdateEvent(UpdateEvent event) {

        for (NetworkPlayerInfo info : mc.getNetHandler().getPlayerInfoMap()) {
            UUID uuid = info.getGameProfile().getId();
            String name = info.getGameProfile().getName();

            if (timer.hasTimeElapsed(5000) && !reported.contains(uuid) && !uuid.equals(mc.thePlayer.getUniqueID())) {
                PacketUtils.sendPacket(new C01PacketChatMessage("/report " + name + " killaura fly speed"));
                reported.add(uuid);
                timer.reset();
            }
        }

        super.onUpdateEvent(event);
    }

    @Override
    public void onWorldEvent(WorldEvent event) {
        reported.clear();
        timer.reset();
        super.onWorldEvent(event);
    }

    @Override
    public void onPacketReceiveEvent(PacketReceiveEvent event) {

        if (event.getPacket() instanceof S02PacketChat) {
            S02PacketChat s02 = (S02PacketChat) event.getPacket();

            if (s02.getChatComponent().getFormattedText().startsWith("Â§cThere is no player named")) {
                event.cancel();
            }
        }

        super.onPacketReceiveEvent(event);
    }
}
