// 
// Decompiled by Procyon v0.5.36
// 

package Lavish.modules.exploit;

import java.util.Iterator;
import Lavish.Client;
import Lavish.event.events.EventRenderGUI;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import net.minecraft.network.play.client.C02PacketUseEntity;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C00PacketKeepAlive;
import net.minecraft.network.play.client.C16PacketClientStatus;
import net.minecraft.network.play.client.C01PacketChatMessage;
import Lavish.event.events.EventPacket;
import Lavish.event.Event;
import net.minecraft.entity.Entity;
import net.minecraft.world.World;
import com.mojang.authlib.GameProfile;
import Lavish.modules.Category;
import Lavish.utils.misc.Timer;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.network.Packet;
import java.util.ArrayList;
import Lavish.modules.Module;

public class Blink extends Module
{
    public ArrayList<Packet> packets;
    private EntityOtherPlayerMP fakePlayer;
    Timer timer;
    boolean idk;
    
    public Blink() {
        super("Blink", 0, true, Category.Exploit, "Teleports your character");
        this.packets = new ArrayList<Packet>();
        this.timer = new Timer();
        this.idk = false;
    }
    
    @Override
    public void onEnable() {
        (this.fakePlayer = new EntityOtherPlayerMP(Blink.mc.theWorld, new GameProfile(Blink.mc.session.getProfile().getId(), Blink.mc.thePlayer.getName()))).setPositionAndRotation(Blink.mc.thePlayer.posX, Blink.mc.thePlayer.posY, Blink.mc.thePlayer.posZ, Blink.mc.thePlayer.rotationYaw, Blink.mc.thePlayer.rotationPitch);
        this.fakePlayer.rotationYawHead = Blink.mc.thePlayer.rotationYawHead;
        this.fakePlayer.inventory = Blink.mc.thePlayer.inventory;
        this.fakePlayer.setSneaking(Blink.mc.thePlayer.isSneaking());
        Blink.mc.theWorld.addEntityToWorld(-1338, this.fakePlayer);
    }
    
    @Override
    public void onEvent(final Event e) {
        if (Blink.mc.thePlayer == null) {
            return;
        }
        if (e instanceof EventPacket && !this.idk && ((EventPacket)e).isSending()) {
            if (!(((EventPacket)e).getPacket() instanceof C01PacketChatMessage) && !(((EventPacket)e).getPacket() instanceof C16PacketClientStatus) && !(((EventPacket)e).getPacket() instanceof C00PacketKeepAlive) && Blink.mc.theWorld != null) {
                e.setCancelled(true);
            }
            final boolean input = Blink.mc.gameSettings.keyBindForward.pressed || Blink.mc.gameSettings.keyBindBack.pressed || Blink.mc.gameSettings.keyBindRight.pressed || Blink.mc.gameSettings.keyBindLeft.pressed || Blink.mc.gameSettings.keyBindJump.pressed || Blink.mc.gameSettings.keyBindSneak.pressed;
            if (input && ((EventPacket)e).getPacket() instanceof C03PacketPlayer) {
                this.packets.add(((EventPacket)e).getPacket());
            }
            if (((EventPacket)e).getPacket() instanceof C02PacketUseEntity || ((EventPacket)e).getPacket() instanceof C08PacketPlayerBlockPlacement || ((EventPacket)e).getPacket() instanceof C07PacketPlayerDigging) {
                this.packets.add(((EventPacket)e).getPacket());
            }
        }
        if (e instanceof EventRenderGUI) {
            Client.instance.font20.drawString("Packets: " + this.packets.size(), (float)(Blink.mc.displayWidth / 2 / 2 - Client.instance.font20.getStringWidth("Packets: " + this.packets.size()) / 2), 30.0f, -1, false);
        }
    }
    
    @Override
    public void onDisable() {
        for (final Packet packet : this.packets) {
            if (packet instanceof C02PacketUseEntity || packet instanceof C08PacketPlayerBlockPlacement || packet instanceof C07PacketPlayerDigging) {
                Blink.mc.thePlayer.swingItem();
            }
            Blink.mc.thePlayer.sendQueue.addToSendQueue(packet);
        }
        this.packets.clear();
        this.idk = false;
        try {
            if (this.fakePlayer != null) {
                Blink.mc.theWorld.removeEntity(this.fakePlayer);
            }
        }
        catch (Exception ex) {}
    }
}
